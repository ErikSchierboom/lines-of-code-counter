# Exercism's Lines of Code Counter

![Tests](https://github.com/exercism/lines-of-code-counter/workflows/Test/badge.svg)

This is Exercism's Lines of Code (LoC) Counter.
It takes a solution and counts its lines of code.

## Implementation

As we only want to count the LoC of files the student wrote, we ignore:

- Test files (the `files.test` array in the exercise `.meta/config.json` file)
- Editor files (the `files.editor` array in the exercise `.meta/config.json` file)
- Example files (the `files.example` array in the exercise `.meta/config.json` file)
- Exemplar files (the `files.exemplar` array in the exercise `.meta/config.json` file)
- Files in hidden directories (e.g. `.docs/instructions.md` or `.meta/config.json`)

The actual counting of the LoC is done using the [tokei](https://github.com/XAMPPRocky/tokei) tool, which is both extremely fast and [supports many languages](https://github.com/XAMPPRocky/tokei#supported-languages).

### Default configuration

The default configuration only counts the LoC of _solution files_ (the `files.solution` array in the exercise `.meta/config.json` file).

While this does indeed exclude the above-mentioned files, it doesn't work well for:

- Old solutions which files were named differently
- Solutions where the student added additional files

Therefore, each track can define a track-specific configuration to allow counting LoC in non-solution files.

### Track-specific configuration

To override the default configuration, each track can define a config file named `<slug>.include` inside the `tracks`directory (e.g. [`tracks/csharp.include`](./tracks/csharp.include)).
This config file defines the rules to determine which files' code should be counted for that track.
The files use the same globbing [syntax](https://git-scm.com/docs/gitignore) as `.gitignore` files, except that the include file works the other way around: you indicate which files to include (excluding is done via the `!` prefix).

You don't have to explicitly exclude the above-mentioned test/editor/example/exemplar/documentation/configuration files.
We'll automatically exclude them for you.

#### Example

Here is an example track-specific configuration:

```gitignore
*.fs
```

With this configuration, only the LoC of files with the `.fs` extension are counted.
Even though test files also have the same `.fs` extension, you don't have to manually exclude them as we automatically add exclude the exercise's test/editor/example/exemplar files.
For the `anagram` exercise, the resulting include file that is used looks like:

```gitignore
*.fs
!AnagramTests.fs
!.meta/Example.fs
```

We'll then count the LoC using this configuration file to determine the actual LoC.

#### Renamed files

It's worth noting that older solutions might be using a different naming scheme than specified in the `files` key in the `.meta/config.json` file.
If your track has changed the names of the test or editor files, consider adding rules to exclude old files that should _not_ be counted.

As an example, the F# track used to have test files that ended with `Test.fs` (singular), but nowadays uses `Tests.fs` (plural).
To exclude the old test files from the LoC count, we can append the following line to the F# track's configuration file:

```gitignore
!*Test.fs
```

## Run the Lines of Code Counter

To count the lines of code of an arbitrary solution, do the following:

1. Open a terminal in the project's root
2. Run `./bin/run.sh <track-slug> <exercise-slug> <solution-dir> <output-dir>`

Once the test runner has finished, its results will be written to `<output-dir>/response.json`.

## Run the Lines of Code Counter on a solution using Docker

_This script is provided for testing purposes, as it mimics how the Lines of Code Counter runs in Exercism's production environment._

To count the lines of code of an arbitrary solution using the Docker image, do the following:

1. Open a terminal in the project's root
2. Run `./bin/run-in-docker.sh <track-slug> <exercise-slug> <solution-dir> <output-dir>`

Once the test runner has finished, its results will be written to `<output-dir>/response.json`.

## Run the tests

To run the tests to verify the behavior of the Lines of Code Counter, do the following:

1. Open a terminal in the project's root
2. Run `./bin/run-tests.sh`

These are [golden tests][golden] that compare the `response.json` generated by running the current state of the code against the "known good" `tests/<test-name>/response.json`. All files created during the test run itself are discarded.

When you've made modifications to the code that will result in a new "golden" state, you'll need to generate and commit a new `tests/<test-name>/response.json` file.

## Run the tests using Docker

_This script is provided for testing purposes, as it mimics how the Lines of Code Counter runs in Exercism's production environment._

To run the tests to verify the behavior of the test runner using the Docker image, do the following:

1. Open a terminal in the project's root
2. Run `./bin/run-tests-in-docker.sh`

These are [golden tests][golden] that compare the `response.json` generated by running the current state of the code against the "known good" `tests/<test-name>/response.json`. All files created during the test run itself are discarded.

When you've made modifications to the code that will result in a new "golden" state, you'll need to generate and commit a new `tests/<test-name>/response.json` file.

## Credit

This repo is built and maintained by Exercism.

Contributions are welcome!

[test-runners]: https://github.com/exercism/automated-tests/blob/master/docs/introduction.md
[golden]: https://ro-che.info/articles/2017-12-04-golden-tests
[exercism]: https://exercism.io
